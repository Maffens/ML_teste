//////////////////////////////////////////////////////////
// DIMENSIONS (Star Schema)
//////////////////////////////////////////////////////////

Table dim_date {
  date_sk      int [pk]
  full_date    date
  year         int
  month        int
  day          int
  week_of_year int
  is_weekend   boolean
  is_holiday   boolean
}

Table dim_site {
  site_sk      int [pk, increment]
  site_id      varchar // Natural Key
  site_name    varchar
  site_type    varchar // ex: Warehouse, Store, Hub
  city         varchar
  state        varchar
  
  // SCD Type 2 Fields
  valid_from   date
  valid_to     date
  is_current   boolean
}

Table dim_product {
  product_sk   int [pk, increment]
  item_id      integer // Natural Key
  product_name varchar
  category     varchar
  brand        varchar

  // SCD Type 2 Fields
  valid_from   date
  valid_to     date
  is_current   boolean
}

Table dim_route {
  route_sk      int [pk, increment]
  route_id      varchar // Natural Key
  route_name    varchar
  
  // SCD Type 2 Fields
  start_date    date
  end_date      date
  is_active     boolean
}

//////////////////////////////////////////////////////////
// FACTS
//////////////////////////////////////////////////////////

Table fct_shipments {
  shipment_sk       int [pk, increment]
  shipping_id       integer // Natural Key
  
  // Foreign Keys (Surrogates)
  site_sk           int
  origin_sk         int
  destination_sk    int
  route_sk          int
  product_sk        int
  
  sales_date_sk       int
  processing_date_sk  int
  delivery_date_sk    int

  // Degenerate Dimensions & Metrics
  sending_method    varchar
  logistic_type     varchar
  status            varchar
  
  // Metadata
  ingestion_date    date
  batch_id          varchar
  created_at        datetime
  source_system     varchar
}

Table fct_inventory_snapshot {
  inventory_sk  int [pk, increment]
  
  // Foreign Keys
  product_sk    int
  site_sk       int // Warehouse Reference
  date_sk       int // Snapshot Date

  // Metrics
  item_quantity integer
  
  // Metadata
  ingestion_date    date
  source_system     varchar
}

Table fct_events {
  event_sk        int [pk, increment]
  event_name      varchar
  category        varchar
  
  // Foreign Keys
  date_sk         int
  site_sk         int
}

Table fct_sop_forecast {
  forecast_sk      int [pk, increment]
  
  // Foreign Keys
  sales_date_sk    int
  site_sk          int
  origin_sk        int
  
  // Metrics & Attributes
  logistic_type    varchar
  forecast_qty     int
  
  // Metadata
  ingestion_date   date
  batch_id         varchar
  created_at       datetime
  source_system    varchar
}

Table fct_spf_demand_forecast {
  forecast_sk      int [pk, increment]

  // Foreign Keys
  sales_date_sk    int
  site_sk          int
  origin_sk        int
  destination_sk   int
  route_sk         int
  
  // Metrics & Attributes
  sending_method   varchar
  forecast_qty     integer

  // Metadata
  ingestion_date   date
  batch_id         varchar
  created_at       datetime
  source_system    varchar
}

Table fct_processing_times {
  proc_time_sk            int [pk, increment]
  
  // Foreign Keys
  site_sk                 int
  origin_sk               int
  destination_sk          int
  route_sk                int
  critical_processing_date_sk int
  
  // Metadata
  ingestion_date          date
  batch_id                varchar
  created_at              datetime
  source_system           varchar
}

Table fct_warehouse_capacity {
  capacity_sk         int [pk, increment]
  
  // Foreign Keys
  site_sk             int // Warehouse Reference
  processing_date_sk  int
  
  // Metrics
  processing_capacity float

  // Metadata
  ingestion_date      date
  batch_id            varchar
  created_at          datetime
  source_system       varchar
}

//////////////////////////////////////////////////////////
// RELATIONSHIPS
//////////////////////////////////////////////////////////

// 1. Date Dimension Relationships
Ref: fct_shipments.sales_date_sk > dim_date.date_sk
Ref: fct_shipments.processing_date_sk > dim_date.date_sk
Ref: fct_shipments.delivery_date_sk > dim_date.date_sk
Ref: fct_sop_forecast.sales_date_sk > dim_date.date_sk
Ref: fct_spf_demand_forecast.sales_date_sk > dim_date.date_sk
Ref: fct_processing_times.critical_processing_date_sk > dim_date.date_sk
Ref: fct_warehouse_capacity.processing_date_sk > dim_date.date_sk
Ref: fct_events.date_sk > dim_date.date_sk
Ref: fct_inventory_snapshot.date_sk > dim_date.date_sk

// 2. Site Dimension Relationships (Roles: Origin, Destination, Site, Warehouse)
Ref: fct_shipments.site_sk > dim_site.site_sk
Ref: fct_shipments.origin_sk > dim_site.site_sk
Ref: fct_shipments.destination_sk > dim_site.site_sk
Ref: fct_sop_forecast.site_sk > dim_site.site_sk
Ref: fct_sop_forecast.origin_sk > dim_site.site_sk
Ref: fct_spf_demand_forecast.site_sk > dim_site.site_sk
Ref: fct_spf_demand_forecast.origin_sk > dim_site.site_sk
Ref: fct_spf_demand_forecast.destination_sk > dim_site.site_sk
Ref: fct_processing_times.site_sk > dim_site.site_sk
Ref: fct_processing_times.origin_sk > dim_site.site_sk
Ref: fct_processing_times.destination_sk > dim_site.site_sk
Ref: fct_warehouse_capacity.site_sk > dim_site.site_sk
Ref: fct_events.site_sk > dim_site.site_sk
Ref: fct_inventory_snapshot.site_sk > dim_site.site_sk

// 3. Route Dimension Relationships
Ref: fct_shipments.route_sk > dim_route.route_sk
Ref: fct_spf_demand_forecast.route_sk > dim_route.route_sk
Ref: fct_processing_times.route_sk > dim_route.route_sk

// 4. Product Dimension Relationships
Ref: fct_shipments.product_sk > dim_product.product_sk
Ref: fct_inventory_snapshot.product_sk > dim_product.product_sk
